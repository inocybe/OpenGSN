<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0">

	<bean id="OutbackMateVirtualTransportProvider"
		class="com.greenstarnetwork.resources.outbackMate.core.VirtualTransportProvider" />

	<!-- Register an IVirtualTransportProvider as an OSGi Service -->
	<service ref="OutbackMateVirtualTransportProvider"
		interface="com.iaasframework.transports.virtual.IVirtualTransportProvider">
		<service-properties>
			<entry key="transport.virtualTransportProvider" value="OutbackMate" />
		</service-properties>
	</service>

	<bean id="OutbackMateCommandFactory"
		class="com.greenstarnetwork.resources.outbackMate.core.OutbackMateCommandFactory">
	</bean>

	<!-- Register a command set as an OSGi Service -->
	<service ref="OutbackMateCommandFactory"
		interface="com.iaasframework.capabilities.commandset.ICommandFactory">
		<service-properties>
			<entry key="commandSet.name" value="OutbackMate" />
			<entry key="commandSet.version" value="1.0.0" />
		</service-properties>
	</service>
	
	<bean id="virtualOutbackMateCommandFactory"
		class="com.greenstarnetwork.resources.outbackMate.core.VirtualOutbackMateCommandFactory">
	</bean>

	<!-- Register a command set as an OSGi Service -->
	<service ref="virtualOutbackMateCommandFactory"
		interface="com.iaasframework.capabilities.commandset.ICommandFactory">
		<service-properties>
			<entry key="commandSet.name" value="VirtualOutbackMate" />
			<entry key="commandSet.version" value="1.0.0" />
		</service-properties>
	</service>
	

	<bean id="OutbackMateActionFactory"
		class="com.greenstarnetwork.resources.outbackMate.core.OutbackMateActionFactory">
	</bean>

	<!--  register the actionset with the osgi registry -->
	<service ref="OutbackMateActionFactory"
		interface="com.iaasframework.capabilities.actionset.IActionFactory">
		<service-properties>
			<entry key="actionSet.name" value="OutbackMate" />
			<entry key="actionSet.version" value="1.0.0" />
		</service-properties>
	</service>

	<!--  Get the CapabilityFactories from the OSGI Repository -->
	<reference id="actionsetCapabilityFactory"
		interface="com.iaasframework.resources.core.capability.ICapabilityFactory"
		filter="(&amp;(capability=ActionSet)(capability.version=1.0.0))" />

	<reference id="commandsetCapabilityFactory"
		interface="com.iaasframework.resources.core.capability.ICapabilityFactory"
		filter="(&amp;(capability=CommandSet)(capability.version=1.0.0))" />

	<reference id="protocolCapabilityFactory"
		interface="com.iaasframework.resources.core.capability.ICapabilityFactory"
		filter="(&amp;(capability=protocol)(capability.version=1.0.0))" />

	<reference id="modelCapabilityFactory"
		interface="com.iaasframework.resources.core.capability.ICapabilityFactory"
		filter="(&amp;(capability=Model)(capability.version=1.0.0))" />

	<reference id="pollerCapabilityFactory"
		interface="com.iaasframework.resources.core.capability.ICapabilityFactory"
		filter="(&amp;(capability=Poller)(capability.version=1.0.0))" />

	<reference id="ArchiveCapabilityFactory"
		interface="com.iaasframework.resources.core.capability.ICapabilityFactory"
		filter="(&amp;(capability=Archive)(capability.version=1.0.1-SNAPSHOT))" />

    <!--  Resource bootstrapper factory class -->
	<bean id="OutbackMateBootstrapperFactory" class="com.greenstarnetwork.resources.outbackMate.core.OutbackMateBootstrapperFactory" />

	<!-- Engine Repository -->
	<bean id="OutbackMateEngineRepository" class="com.iaasframework.resources.core.ResourceRepository"  init-method="init">
		<argument value="OutbackMate" />
		<property name="capabilityFactories">
			<map>
				<entry key="ActionSet" value-ref="actionsetCapabilityFactory" />
				<entry key="CommandSet" value-ref="commandsetCapabilityFactory" />
				<entry key="protocol" value-ref="protocolCapabilityFactory" />
				<entry key="Model" value-ref="modelCapabilityFactory" />
				<entry key="Poller" value-ref="pollerCapabilityFactory" />
		     	<entry key="Archive" value-ref="ArchiveCapabilityFactory" />
			</map>
		</property>
		<property name="resourceBootstrapperFactory" ref="OutbackMateBootstrapperFactory"/>
		<!--  Persistence unit must be the last property, because it will cause the descriptor repository 
			to be initialized -->
		<property name="persistenceUnit" value="ResourceCore"/> 		
	</bean>

	<!--  register the repostiory with the OSGI registry -->
	<service ref="OutbackMateEngineRepository"
		interface="com.iaasframework.resources.core.IResourceRepository">
		<service-properties>
			<entry key="type" value="OutbackMate" />
			<entry key="version" value="1.0.0" />
		</service-properties>
	</service>
</blueprint>